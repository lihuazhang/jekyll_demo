
<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
   <meta charset="utf-8" />
   <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
   <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

   <title>Using SHJS for Jekyll - 8 at My House</title>
	
	<meta name="description" content="

  
    Using SHJS for Jekyll
    
      2013/02/02 Saturday
    
  

  我不想用Octopress自带的代码高亮插件，所以自己写了个插件，借助 SHJS 实现代码高亮。由于Haml的缩进问题，不得以把每行代码都用code...">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link href="" rel="alternate" title="8 at My House" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
   <meta name="robots" content="noindex, nofollow">
   <meta name="keywords" content="metro, metroui, metro-ui, metro ui, windows 8, metro style, bootstrap, framework, web framework, css, html" />
   <meta name="author" content="晋恒温"/>

   <!-- remove or comment this line if you want to use the local fonts -->
   <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700' rel='stylesheet' type='text/css'>

   <link rel="stylesheet" type="text/css" href="/bootmetro/css/bootstrap.css">
   <link rel="stylesheet" type="text/css" href="/bootmetro/css/bootstrap-responsive.css">
   <link rel="stylesheet" type="text/css" href="/bootmetro/css/bootmetro.css">
   <link rel="stylesheet" type="text/css" href="/bootmetro/css/bootmetro-tiles.css">
   <link rel="stylesheet" type="text/css" href="/bootmetro/css/bootmetro-charms.css">
   <link rel="stylesheet" type="text/css" href="/bootmetro/css/metro-ui-light.css">
   <link rel="stylesheet" type="text/css" href="/bootmetro/css/icomoon.css">
   <link rel="stylesheet" type="text/css" href="/stylesheets/syntax.css">
   <link rel="stylesheet" type="text/css" href="/stylesheets/custom.css">


   <!-- Le fav and touch icons -->
   <link rel="shortcut icon" href="/images/favicon.ico">

   <!-- All JavaScript at the bottom, except for Modernizr and Respond.
      Modernizr enables HTML5 elements & feature detects; Respond is a polyfill for min/max-width CSS3 Media Queries
      For optimal performance, use a custom Modernizr build: www.modernizr.com/download/ -->
   <script src="/scripts/modernizr-2.6.1.min.js"></script>
</head>
<!-- Prompt IE 6 users to install Chrome Frame. Remove this if you support IE 6.
     chromium.org/developers/how-tos/chrome-frame-getting-started -->
<!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->


<body>
<header id="nav-bar" class="container-fluid">
   <div class="row-fluid">
      <div class="span8">
         <div id="header-container">
            <a id="backbutton" class="win-backbutton" href="/index.html"></a>
            <h5>8 at My House</h5>
            <div class="dropdown">
               <a class="header-dropdown dropdown-toggle accent-color" data-toggle="dropdown" href="#">
                 Using SHJS for Jekyll
                  <b class="caret"></b>
               </a>
               <ul class="dropdown-menu">
               	<li><a href="/archives.html">存档</a></li>
               	<li><a href="/categories.html">分类</a></li>
               <li class="divider"></li>
               <li><a href="./index.html">Home</a></li>
            </ul>
         </div>
         </div>
      </div>
      <div id="top-info" class="pull-right">
      <a href="#" class="pull-left">
         <div id="authorname" class="top-info-block">
           <h3>晋恒温</h3>
         </div>
         <div class="top-info-block">
            <b class="icon-user"></b>
         </div>
      </a>
   </div>
</div>
</header>


<div class="container">
<article class="entry" id="/blog/using-shjs-for-jekyll">
  <header>
    <h1 class="entry-title">Using SHJS for Jekyll</h1>
    <p class="entry-meta">
      <time>2013/02/02 Saturday</time>
    </p>
  </header>

  <p>我不想用Octopress自带的代码高亮插件，所以自己写了个插件，借助 <a href="http://shjs.sourceforge.net">SHJS</a> 实现代码高亮。由于Haml的缩进问题，不得以把每行代码都用code标签包了下～</p>

<p>使用方法：<code>sh [:lang]</code>，<code>[:lang]</code>默认是<code>:js</code>。</p>

<p>插件代码如下：</p>
<div class="highlight"><pre><code class="ruby"><span class="c1"># To highlight source code in an HTML document using SHJS for Jekyll</span>
<span class="c1"># (c) 晋恒温 | http://MrZhang.me | MIT Licensed.</span>

<span class="nb">require</span> <span class="s2">&quot;cgi&quot;</span>

<span class="k">module</span> <span class="nn">Jekyll</span>

  <span class="k">class</span> <span class="nc">SHJS</span> <span class="o">&lt;</span> <span class="ss">Liquid</span><span class="p">:</span><span class="ss">:Block</span>

    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">tag_name</span><span class="p">,</span> <span class="n">markup</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span>
      <span class="vi">@lang</span> <span class="o">=</span> <span class="s2">&quot;js&quot;</span>
      <span class="k">if</span> <span class="n">markup</span> <span class="o">=~</span> <span class="sr">/\s*:(\w+)/i</span>
        <span class="vi">@lang</span> <span class="o">=</span> <span class="vg">$1</span>
      <span class="k">end</span>
      <span class="vi">@lang</span> <span class="o">=</span> <span class="n">format_lang</span> <span class="vi">@lang</span>
      <span class="k">super</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
      <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&lt;pre class=&#39;sh_</span><span class="si">#{</span> <span class="vi">@lang</span> <span class="si">}</span><span class="s2">&#39;&gt;&quot;</span>
      <span class="n">code</span> <span class="o">=</span> <span class="no">CGI</span><span class="o">.</span><span class="n">escapeHTML</span> <span class="k">super</span><span class="o">.</span><span class="n">lstrip</span><span class="o">.</span><span class="n">rstrip</span>
      <span class="n">code</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
        <span class="n">source</span> <span class="o">+=</span> <span class="s2">&quot;&lt;code&gt;</span><span class="si">#{</span> <span class="n">line</span> <span class="si">}</span><span class="s2">&lt;/code&gt;&quot;</span>
      <span class="k">end</span>
      <span class="n">source</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/pre&gt;&quot;</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">format_lang</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>
      <span class="k">return</span> <span class="s2">&quot;javascript&quot;</span> <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;js&quot;</span>
      <span class="k">return</span> <span class="s2">&quot;ruby&quot;</span> <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;ru&quot;</span>
      <span class="n">lang</span>
    <span class="k">end</span>

  <span class="k">end</span>

<span class="k">end</span>

<span class="ss">Liquid</span><span class="p">:</span><span class="ss">:Template</span><span class="o">.</span><span class="n">register_tag</span><span class="p">(</span><span class="s2">&quot;sh&quot;</span><span class="p">,</span> <span class="ss">Jekyll</span><span class="p">:</span><span class="ss">:SHJS</span><span class="p">)</span>
</code></pre></div>

  <footer>
    <a href="/blog/using-shjs-for-jekyll.html">&laquo; Using SHJS for Jekyll</a>
    
  </footer>
</article>

</div>



<!-- Grab Google CDN's jQuery. fall back to local if necessary -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script>window.jQuery || document.write("<script src='/scripts/jquery-1.8.2.min.js'>\x3C/script>")</script>
<script type="text/javascript" src="/scripts/jquery.mousewheel.js"></script>
<script type="text/javascript" src="/scripts/jquery.scrollTo.js"></script>
<script type="text/javascript" src="/scripts/bootstrap.min.js"></script>
<script type="text/javascript" src="/scripts/bootstrap-carousel.js"></script>
<script type="text/javascript" src="/scripts/bootmetro.js"></script>
<script type="text/javascript" src="/scripts/bootmetro-charms.js"></script>
<script type="text/javascript" src="/scripts/holder.js"></script>
<script type="text/javascript" src="/scripts/tile-slider.js"></script>
<script type="text/javascript">
   $(".metro").metro();
</script>

</body>
</html>
